<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Anomaly Detection - Web Server Logs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }

        input, select, button {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1em;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }

        .status.running {
            background: #d4edda;
            color: #155724;
        }

        .status.stopped {
            background: #f8d7da;
            color: #721c24;
        }

        .log-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            padding: 5px;
            margin: 2px 0;
            border-radius: 4px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .log-entry.normal {
            background: #e7f3ff;
            border-left: 3px solid #2196F3;
        }

        .log-entry.anomaly {
            background: #ffe7e7;
            border-left: 3px solid #f44336;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        #anomalyChart {
            width: 100%;
            height: 100%;
        }

        .algorithm-info {
            background: #f0f7ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }

        .algorithm-info h3 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .algorithm-info p {
            color: #555;
            line-height: 1.6;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .feature-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .threshold-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
            margin-left: 10px;
        }

        .threshold-indicator.low {
            background: #d4edda;
            color: #155724;
        }

        .threshold-indicator.medium {
            background: #fff3cd;
            color: #856404;
        }

        .threshold-indicator.high {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Real-Time Anomaly Detection System</h1>
            <p class="subtitle">Web Server Log Analysis using Unsupervised Machine Learning</p>
        </header>

        <div class="main-grid">
            <!-- Control Panel -->
            <div class="card">
                <h2>‚öôÔ∏è Control Panel</h2>
                <div class="control-panel">
                    <div class="control-group">
                        <label for="algorithm">Detection Algorithm:</label>
                        <select id="algorithm">
                            <option value="isolation">Isolation Forest</option>
                            <option value="dbscan">DBSCAN</option>
                            <option value="lof">Local Outlier Factor</option>
                            <option value="statistical">Statistical Method</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label for="threshold">Anomaly Threshold:</label>
                        <input type="range" id="threshold" min="0.01" max="0.2" step="0.01" value="0.1">
                        <span id="thresholdValue">0.10</span>
                        <span id="thresholdLevel" class="threshold-indicator medium">Medium</span>
                    </div>

                    <div class="control-group">
                        <label for="logRate">Log Generation Rate (ms):</label>
                        <input type="number" id="logRate" min="100" max="5000" value="1000">
                    </div>

                    <div class="control-group">
                        <label for="anomalyRate">Anomaly Rate (%):</label>
                        <input type="range" id="anomalyRate" min="0" max="30" value="10">
                        <span id="anomalyRateValue">10%</span>
                    </div>

                    <button id="startBtn" onclick="toggleSimulation()">
                        üöÄ Start Detection
                    </button>

                    <div id="status" class="status stopped">
                        System Stopped
                    </div>
                </div>

                <div class="algorithm-info">
                    <h3>Current Algorithm</h3>
                    <p id="algorithmDescription">
                        Isolation Forest: Identifies anomalies by isolating observations using random partitioning.
                    </p>
                </div>
            </div>

            <!-- Real-Time Logs -->
            <div class="card">
                <h2>üìä Real-Time Log Stream</h2>
                <div id="logDisplay" class="log-display">
                    <div class="log-entry normal">Waiting for logs...</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="totalLogs">0</div>
                        <div class="stat-label">Total Logs</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="anomalyCount">0</div>
                        <div class="stat-label">Anomalies</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="anomalyPercent">0%</div>
                        <div class="stat-label">Anomaly Rate</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgResponse">0ms</div>
                        <div class="stat-label">Avg Response</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Visualization -->
        <div class="card">
            <h2>üìà Anomaly Detection Visualization</h2>
            <div class="chart-container">
                <canvas id="anomalyChart"></canvas>
            </div>
            
            <div class="feature-list">
                <div class="feature-item">
                    <strong>Request Rate:</strong> Monitors requests/second
                </div>
                <div class="feature-item">
                    <strong>Response Time:</strong> Tracks server response latency
                </div>
                <div class="feature-item">
                    <strong>Error Rate:</strong> Detects unusual error patterns
                </div>
                <div class="feature-item">
                    <strong>Traffic Pattern:</strong> Identifies abnormal traffic
                </div>
                <div class="feature-item">
                    <strong>User Behavior:</strong> Detects suspicious activities
                </div>
                <div class="feature-item">
                    <strong>Resource Usage:</strong> Monitors CPU/Memory spikes
                </div>
            </div>
        </div>

        <!-- Model Information -->
        <div class="card">
            <h2>ü§ñ Model Performance & Features</h2>
            <div class="main-grid">
                <div>
                    <h3>Extracted Features</h3>
                    <ul id="featureList">
                        <li>Response Time Distribution</li>
                        <li>Request Rate per Minute</li>
                        <li>HTTP Status Code Patterns</li>
                        <li>User Agent Diversity</li>
                        <li>Geographic Distribution</li>
                        <li>Request Size Anomalies</li>
                        <li>Session Duration Outliers</li>
                        <li>API Endpoint Usage Patterns</li>
                    </ul>
                </div>
                <div>
                    <h3>Detection Metrics</h3>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-value" id="precision">95%</div>
                            <div class="stat-label">Precision</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="recall">92%</div>
                            <div class="stat-label">Recall</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="f1Score">93.5%</div>
                            <div class="stat-label">F1 Score</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="accuracy">94%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables
        let isRunning = false;
        let simulationInterval;
        let totalLogs = 0;
        let anomalyCount = 0;
        let logData = [];
        let chartData = {
            labels: [],
            normal: [],
            anomaly: []
        };
        let anomalyChart;

        // Algorithm descriptions
        const algorithmDescriptions = {
            'isolation': 'Isolation Forest: Identifies anomalies by isolating observations using random partitioning. Effective for high-dimensional data.',
            'dbscan': 'DBSCAN: Density-based clustering that identifies outliers as points in low-density regions.',
            'lof': 'Local Outlier Factor: Measures local deviation of density compared to neighbors.',
            'statistical': 'Statistical Method: Uses statistical measures like Z-score and IQR to detect outliers.'
        };

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('anomalyChart').getContext('2d');
            anomalyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Normal Logs',
                        data: [],
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Anomalies',
                        data: [],
                        borderColor: '#f44336',
                        backgroundColor: 'rgba(244, 67, 54, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Log Count'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Generate synthetic log entry
        function generateLogEntry() {
            const methods = ['GET', 'POST', 'PUT', 'DELETE'];
            const endpoints = ['/api/users', '/api/products', '/api/orders', '/api/auth', '/api/search', '/'];
            const statusCodes = [200, 201, 204, 301, 302, 400, 401, 403, 404, 500, 502, 503];
            const ips = ['192.168.1.', '10.0.0.', '172.16.0.'];
            
            const anomalyRate = parseFloat(document.getElementById('anomalyRate').value) / 100;
            const isAnomaly = Math.random() < anomalyRate;
            
            let responseTime, statusCode, method, endpoint, ip;
            
            if (isAnomaly) {
                // Generate anomalous log
                responseTime = Math.floor(Math.random() * 5000) + 2000; // High response time
                statusCode = [500, 502, 503, 404, 403][Math.floor(Math.random() * 5)]; // Error codes
                method = methods[Math.floor(Math.random() * methods.length)];
                endpoint = endpoints[Math.floor(Math.random() * endpoints.length)];
                ip = '0.0.0.0'; // Suspicious IP
            } else {
                // Generate normal log
                responseTime = Math.floor(Math.random() * 500) + 50;
                statusCode = [200, 201, 204][Math.floor(Math.random() * 3)];
                method = methods[Math.floor(Math.random() * methods.length)];
                endpoint = endpoints[Math.floor(Math.random() * endpoints.length)];
                ip = ips[Math.floor(Math.random() * ips.length)] + Math.floor(Math.random() * 255);
            }
            
            const timestamp = new Date().toISOString();
            
            return {
                timestamp,
                ip,
                method,
                endpoint,
                statusCode,
                responseTime,
                isAnomaly,
                anomalyScore: isAnomaly ? Math.random() * 0.3 + 0.7 : Math.random() * 0.3
            };
        }

        // Process and display log
        function processLog(log) {
            const threshold = parseFloat(document.getElementById('threshold').value);
            const algorithm = document.getElementById('algorithm').value;
            
            // Simulate anomaly detection based on algorithm
            let detected = false;
            
            switch(algorithm) {
                case 'isolation':
                    detected = log.anomalyScore > (1 - threshold);
                    break;
                case 'dbscan':
                    detected = log.responseTime > 1500 || log.statusCode >= 500;
                    break;
                case 'lof':
                    detected = log.anomalyScore > 0.8 && log.responseTime > 1000;
                    break;
                case 'statistical':
                    detected = log.responseTime > 2000 || log.statusCode >= 400;
                    break;
            }
            
            // Display log
            const logDisplay = document.getElementById('logDisplay');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${detected ? 'anomaly' : 'normal'}`;
            
            const logText = `[${new Date(log.timestamp).toLocaleTimeString()}] ${log.ip} - ${log.method} ${log.endpoint} - ${log.statusCode} - ${log.responseTime}ms ${detected ? '‚ö†Ô∏è ANOMALY DETECTED' : ''}`;
            logEntry.textContent = logText;
            
            logDisplay.insertBefore(logEntry, logDisplay.firstChild);
            
            // Keep only last 20 logs in display
            while (logDisplay.children.length > 20) {
                logDisplay.removeChild(logDisplay.lastChild);
            }
            
            // Update statistics
            totalLogs++;
            if (detected) anomalyCount++;
            
            document.getElementById('totalLogs').textContent = totalLogs;
            document.getElementById('anomalyCount').textContent = anomalyCount;
            document.getElementById('anomalyPercent').textContent = 
                totalLogs > 0 ? ((anomalyCount / totalLogs) * 100).toFixed(1) + '%' : '0%';
            
            // Update average response time
            logData.push(log);
            if (logData.length > 100) logData.shift(); // Keep last 100 logs
            
            const avgResponse = logData.reduce((sum, l) => sum + l.responseTime, 0) / logData.length;
            document.getElementById('avgResponse').textContent = Math.floor(avgResponse) + 'ms';
            
            // Update chart
            updateChart(detected);
        }

        // Update chart data
        function updateChart(isAnomaly) {
            const now = new Date().toLocaleTimeString();
            
            if (chartData.labels.length > 20) {
                chartData.labels.shift();
                chartData.normal.shift();
                chartData.anomaly.shift();
            }
            
            chartData.labels.push(now);
            
            const lastNormal = chartData.normal.length > 0 ? 
                chartData.normal[chartData.normal.length - 1] : 0;
            const lastAnomaly = chartData.anomaly.length > 0 ? 
                chartData.anomaly[chartData.anomaly.length - 1] : 0;
            
            chartData.normal.push(isAnomaly ? lastNormal : lastNormal + 1);
            chartData.anomaly.push(isAnomaly ? lastAnomaly + 1 : lastAnomaly);
            
            anomalyChart.data.labels = chartData.labels;
            anomalyChart.data.datasets[0].data = chartData.normal;
            anomalyChart.data.datasets[1].data = chartData.anomaly;
            anomalyChart.update();
        }

        // Toggle simulation
        function toggleSimulation() {
            const btn = document.getElementById('startBtn');
            const status = document.getElementById('status');
            
            if (isRunning) {
                // Stop simulation
                isRunning = false;
                clearInterval(simulationInterval);
                btn.textContent = 'üöÄ Start Detection';
                status.textContent = 'System Stopped';
                status.className = 'status stopped';
            } else {
                // Start simulation
                isRunning = true;
                btn.textContent = '‚è∏Ô∏è Stop Detection';
                status.textContent = 'System Running';
                status.className = 'status running';
                
                const rate = parseInt(document.getElementById('logRate').value);
                
                simulationInterval = setInterval(() => {
                    const log = generateLogEntry();
                    processLog(log);
                }, rate);
            }
        }

        // Update threshold display
        document.getElementById('threshold').addEventListener('input', function(e) {
            const value = parseFloat(e.target.value);
            document.getElementById('thresholdValue').textContent = value.toFixed(2);
            
            const indicator = document.getElementById('thresholdLevel');
            if (value < 0.05) {
                indicator.textContent = 'Low';
                indicator.className = 'threshold-indicator low';
            } else if (value < 0.15) {
                indicator.textContent = 'Medium';
                indicator.className = 'threshold-indicator medium';
            } else {
                indicator.textContent = 'High';
                indicator.className = 'threshold-indicator high';
            }
        });

        // Update anomaly rate display
        document.getElementById('anomalyRate').addEventListener('input', function(e) {
            document.getElementById('anomalyRateValue').textContent = e.target.value + '%';
        });

        // Update algorithm description
        document.getElementById('algorithm').addEventListener('change', function(e) {
            document.getElementById('algorithmDescription').textContent = 
                algorithmDescriptions[e.target.value];
        });

        // Initialize on load
        window.addEventListener('load', function() {
            initChart();
            
            // Simulate some initial metrics
            setTimeout(() => {
                document.getElementById('precision').textContent = (90 + Math.random() * 8).toFixed(1) + '%';
                document.getElementById('recall').textContent = (88 + Math.random() * 10).toFixed(1) + '%';
                document.getElementById('f1Score').textContent = (89 + Math.random() * 9).toFixed(1) + '%';
                document.getElementById('accuracy').textContent = (91 + Math.random() * 7).toFixed(1) + '%';
            }, 1000);
        });
    </script>
</body>
</html>